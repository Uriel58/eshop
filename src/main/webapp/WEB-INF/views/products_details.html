<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title th:text="'商品詳細 - ' + ${product.prodName}">商品詳細</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<style>
.product-image-large {
	width: 100%;
	max-height: 500px;
	object-fit: contain;
}

.product-detail-label {
	font-weight: bold;
	margin-top: 10px;
}
</style>
</head>
<body>
	<!--Product詳細展示應有prod_tags,prod_name,prod_type(大類),prod_line(大類的細分),
    * prod_price(每3位數加,),prod_info(產品資訊),prod_images,prod_stock_qty
    * 而prod_images需展示大些（右半邊）
	-->
	<p th:if="${customer != null}">
		歡迎，<span th:text="${customer.name}">顧客名稱</span>！
	</p>
	<p th:if="${customer == null}">
		歡迎，<span th:text="#{home.visitor}">訪客</span>！
	</p>
	<div class="container mt-5">
		<h2 th:text="${product.prodName}">商品名稱</h2>
		<div class="row mt-4">
			<!-- 左半：圖片展示 -->
			<div class="col-md-6">
				<img class="product-image" th:if="${product.prodImages != null}"
					th:src="@{'/resources/images/' + ${product.prodImages}}"
					style="width: 300px; height: auto;" />
				<!-- alt="Product Image" -->
			</div>

			<!-- 右半：商品資訊 -->
			<div class="col-md-6 text-center">
				<p>
					<span class="product-detail-label">產品標籤：</span> <span
						th:text="${product.prodTags}"></span>
				</p>
				<p>
					<span class="product-detail-label">類別：</span> <span
						th:text="${product.prodType}"></span>
				</p>
				<p>
					<span class="product-detail-label">子分類：</span> <span
						th:text="${product.prodLine}"></span>
				</p>
				<p>
					<span class="product-detail-label">價格：</span> <span
						th:text="${#numbers.formatDecimal(product.prodPrice, 0, 'COMMA', 2, 'POINT')} + ' 元'">0
						元</span>
				</p>
				<p>
					<span class="product-detail-label">庫存數量：</span> <span
						th:text="${product.prodStockQty}"></span>
				</p>
				<p>
					<span class="product-detail-label">產品資訊：</span>
				</p>
				<p>
					<span th:text="${product.prodInfo}">產品描述:</span>
				</p>
			</div>
		</div>



		<div class="mt-4">
			<!-- /*返回按鈕 */-->
			<a th:href="@{/}" class="btn btn-secondary">回首頁</a>

			<!-- 已有購物車 -->
			<form th:if="${cart != null}"
				th:action="@{/cart/{cartId}/add-product(cartId=${cart.cartId})}"
				method="post" class="d-inline">
				<input type="hidden" name="productId" th:value="${product.id}" /> <input
					type="hidden" name="quantity" value="1" /> <input type="hidden"
					name="price" th:value="${product.prodPrice}" />
				<button type="submit" class="btn btn-secondary">加入購物車</button>
			</form>

			<!-- 尚未有購物車 -->
			<form th:if="${cart == null and customer != null}"
				th:action="@{/cart/add}" method="post" class="d-inline">
				<input type="hidden" name="customerId"
					th:value="${customer.customerId}" /> <input type="hidden"
					name="productId" th:value="${product.prodNum}" /> <input
					type="hidden" name="quantity" value="1" /> <input type="hidden"
					name="price" th:value="${product.prodPrice}" />
				<button type="submit" class="btn btn-primary">建立購物車並加入商品</button>
			</form>

			<!-- 尚未登入 -->
			<div th:if="${customer == null}">
				<p class="text-danger mt-3">請先登入後再加入購物車。</p>
				<a th:href="@{/login}" class="btn btn-outline-primary mt-2">登入</a>
			</div>

			<!-- 顯示成功訊息（若有） -->
			<div id="cart-message" th:text="${successMessage}"
				style="display: none;"></div>

			<!--  <script>
				document.addEventListener("DOMContentLoaded", function() {
					const msgDiv = document.getElementById("cart-message");
					const message = msgDiv ? msgDiv.textContent.trim() : "";
					if (message.length > 0) {
						alert(message); // ✅ 只有在購物動作後 redirect 回來才會顯示
					}
				});
			</script>-->
		</div>
</body>
</html>
