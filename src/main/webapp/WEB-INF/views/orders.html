<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Order Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2 th:text="${name != null} ? ${'Hello！ ' + name} : 'Hello！ visitor'"></h2>

    <a th:href="@{/}" class="btn btn-outline-secondary mb-3">Back</a>
    <a th:href="@{/orders/add}" class="btn btn-primary mb-3">Add New Order</a>

    <h3>Order Information</h3>
    <table class="table table-bordered">
        <tr><th>Order Number</th><td th:text="${order.ordNum}"></td></tr>
        <tr><th>Order Date</th><td th:text="${#dates.format(order.ordDate, 'yyyy‑MM‑dd HH:mm')}"></td></tr>
        <tr><th>County</th><td th:text="${order.county}"></td></tr>
        <tr><th>Customer Number</th><td th:text="${order.custNum}"></td></tr>
        <tr><th>Status</th><td th:text="${order.orderStatus}"></td></tr>
        <tr><th>Payment Method</th><td th:text="${order.paymentMethod}"></td></tr>
        <tr><th>Delivery Method</th><td th:text="${order.deliveryMethod}"></td></tr>
        <tr><th>Order Barcode</th><td th:text="${order.orderBarcode}"></td></tr>
    </table>

    <h3>Order Details</h3>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Product Number</th>
                <th>Product Name</th>
                <th>Quantity Ordered</th>
                <th>Price Each</th>
                <th>Total Price (ord_price)</th>
                <th>Fare</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody th:each="detail : ${order.orderDetails}">
            <td th:text="${detail.prodNum}"></td>
            <td th:text="${detail.product.prodName}"></td>
            <td th:text="${detail.ordQty}"></td>
            <td th:text="${detail.product.prodPrice}"></td>
            <td th:text="${detail.ordPrice}"></td>
            <td th:text="${detail.fare}"></td>
            <td>
                <a th:href="@{/orders/details/{ordNum}/delete-detail/{prodNum}(ordNum=${detail.ordNum},prodNum=${detail.prodNum})}"
                   class="btn btn-danger btn-sm"
                   onclick="return confirm('Are you sure you want to delete this detail?');">
                   Delete
                </a>
            </td>
        </tbody>
    </table>

    <h4>Add Order Detail</h4>
    <form th:action="@{/orders/details/{ordNum}/add-detail(ordNum=${order.ordNum})}"
          th:object="${orderDetail}" method="post" class="mt-3">
        <div class="row">
            <div class="col-md-3 mb-3">
                <label>Product Number</label>
                <input type="number" th:field="*{prodNum}" class="form-control" required>
            </div>

            <div class="col-md-3 mb-3">
                <label>Quantity</label>
                <input type="number" th:field="*{ordQty}" class="form-control" required>
            </div>

            <div class="col-md-3 mb-3">
                <label>Price Each</label>
                <input type="number" step="0.01" th:field="*{product.prodPrice}" class="form-control" required>
            </div>

            <div class="col-md-3 mb-3">
                <label>Fare</label>
                <input type="number" step="0.01" th:field="*{fare}" class="form-control" required>
            </div>
        </div>

        <button type="submit" class="btn btn-success">Add Detail</button>
    </form>

    <a th:href="@{/logout}" class="btn btn-danger mt-4">Logout</a>
</div>
</body>
</html>
