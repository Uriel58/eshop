<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Order Details</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
</head>
<body>
	<div class="container mt-4">
		<h1 th:if="${name}">
			<span th:text="#{home.message} + ${name}"></span>
		</h1>
		<h1 th:unless="${name}">
			<span th:text="#{home.message} + #{home.visitor}"></span>
		</h1>

		<a th:href="@{/}" class="btn btn-outline-secondary mb-3">Back</a> <a
			th:href="@{/orders/add}" class="btn btn-primary mb-3">Add New
			Order</a>

		<h3>Order Information</h3>
		<table class="table table-bordered">
			<thead>
				<tr>
					<th>Order Number</th>
					<th>Order Date</th>
					<th>Update Date</th>
					<th>County</th>
					<th>Customer Number</th>
					<th>Status</th>
					<th>Payment Method</th>
					<th>Order Barcode</th>
					<th>Product Number</th>
					<th>Price Each</th>
					<th>Quantity Ordered</th>
					<th>Total Price (ord_price)</th>
					<th>Fare</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				<!-- 遍历所有订单 -->
				<tr th:each="order : ${orders}">
					<!-- 主订单信息 -->
					<td th:text="${order.ordNum}"
						rowspan="${#lists.size(order.orderDetails)}"></td>
					<td th:text="${order.ordDate}"
						rowspan="${#lists.size(orderDetails)}"></td>
					<td th:text="${order.requiredDate}"
						rowspan="${#lists.size(orderDetails)}"></td>
					<td th:text="${order.county}"
						rowspan="${#lists.size(orderDetails)}"></td>
					<td th:text="${order.custNum}"
						rowspan="${#lists.size(orderDetails)}"></td>
					<td th:text="${order.orderStatus}"
						rowspan="${#lists.size(orderDetails)}"></td>
					<td th:text="${order.paymentMethod}"
						rowspan="${#lists.size(orderDetails)}"></td>
					<td th:text="${order.orderBarcode}"
						rowspan="${#lists.size(orderDetails)}"></td>

					<!-- 第一条订单明细 -->
					
					<td th:if="${order.orderDetails}"> 
						<span th:text="${order.orderDetails[0].prodNum}"></span>
					</td>
					<td th:unless="${order.orderDetails}">
						<span th:text=" "></span>
					</td>
					<td th:if="${order.orderDetails}"> 
						<span th:text="${order.orderDetails[0].ordQty}"></span>
					</td>
					<td th:unless="${order.orderDetails}">
						<span th:text=" "></span>
					</td>
					<td th:if="${order.orderDetails}">
						<span th:text="${order.orderDetails[0].ordPrice}"></span>
					</td>
					<td th:unless="${order.orderDetails}">
						<span th:text=" "></span>
					</td>
					<td th:if="${order.orderDetails}">
						<span th:text="${order.orderDetails[0].fare}"></span>
					</td>
					<td th:unless="${order.orderDetails}">
						<span th:text=" "></span>
					</td>
					<td><a
						th:href="@{/orders/details/{ordNum}/delete-detail/{prodNum}(ordNum=${order.orderDetails[0].ordNum}, prodNum=${order.orderDetails[0].prodNum})}"
						class="btn btn-danger btn-sm"
						onclick="return confirm('Are you sure you want to delete this detail?');">Delete</a>
					</td>
				</tr>

				<!-- 遍历除了第一条外的其他订单明细 -->
				<tr th:each="detail : ${orderDetails}">
					<td th:if="${order.orderDetails != null}">
						<span th:text="${detail.prodNum}"></span>
					</td>
					<td th:unless="${order.orderDetails == null}">
						<span th:text="'N/A'"></span>
					</td>
					<td th:if="${order.orderDetails != null}">
						<span th:text="${detail.ordQty}"></span>
					</td>
					<td th:unless="${order.orderDetails == null}">
						<span th:text="'N/A'"></span>
					</td>
					<td th:if="${order.orderDetails != null}">
						<span th:text="${detail.ordPrice}"></span>
					</td>
					<td th:unless="${order.orderDetails == null}">
						<span th:text="'N/A'"></span>
					</td>
					<td th:if="${order.orderDetails != null}">
						<span th:text="${detail.fare}"></span>
					</td>
					<td th:unless="${order.orderDetails == null}">
						<span th:text="'N/A'"></span>
					</td>
					<td><a
						th:href="@{/orders/details/{ordNum}/delete-detail/{prodNum}(ordNum=${detail.ordNum}, prodNum=${detail.prodNum})}"
						class="btn btn-danger btn-sm"
						onclick="return confirm('Are you sure you want to delete this detail?');">Delete</a>
					</td>
				</tr>
			</tbody>
		</table>

		<a th:href="@{/logout}" class="btn btn-danger mt-4">Logout</a>
	</div>
</body>
</html>
