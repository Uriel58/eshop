<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title th:text="#{a.product_list}">Product List</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    .product-image {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 2px;
    }
    .no-image {
        width: 100px;
        height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
        border: 1px dashed #ddd;
        border-radius: 4px;
        color: #6c757d;
        font-size: 12px;
    }
</style>
</head>
<body>
	<div class="container mt-4">
		<!-- 登入者名稱 -->
		<h1 th:if="${name}">
			<span th:text="#{home.message} + ${name}"></span>
		</h1>
		<h1 th:unless="${name}">
			<span th:text="#{home.message} + #{home.visitor}"></span>
		</h1>
		
		<a th:href="@{/products/?lang=en}" class="btn btn-outline-secondary mb-3">English</a>
		<a th:href="@{/products/?lang=zh_TW}" class="btn btn-outline-secondary mb-3">繁體中文</a>
		<a th:href="@{/admin}" class="btn btn-outline-secondary mb-3" th:text="#{a.back}">Back</a>
		
		<!-- 登出+註冊按鈕 -->
		<div th:if="${name}">
			<a th:href="@{/logout}" class="btn btn-danger me-2" th:text="#{a.logout}">Logout</a>
			<a th:href="@{/users/add}" class="btn btn-warning" th:text="#{a.register}">Register</a>
		</div>
		
		<!-- 登入+註冊按鈕 -->
		<div th:unless="${name}">
			<a th:href="@{/login}" class="btn btn-success me-2" th:text="#{a.login}">Login</a>
			<a th:href="@{/users/add}" class="btn btn-warning" th:text="#{a.register}">Register</a>
		</div>
		
		<h1 th:text="#{a.product_list}">Product List</h1>

		<!-- 新增商品按鈕 -->
		<a th:href="@{/products/add}" class="btn btn-primary mb-3" th:text="#{a.add_new_product}">Add New Product</a>
		<a th:href="@{/customers}" class="btn btn-primary mb-3" th:text="#{a.customer_list}">Customer List</a>
		<a th:href="@{/users}" class="btn btn-primary mb-3" th:text="#{a.user_list}">User List</a>
		<a th:href="@{/orders}" class="btn btn-primary mb-3" th:text="#{a.order_list}">Order List</a>
		<a th:href="@{/categories}" class="btn btn-primary mb-3" th:text="#{a.category_list}">Category List</a>
		
		<table class="table table-striped">
			<thead>
				<tr>
					<th th:text="#{a.id}">ID</th>
					<th th:text="#{a.product_tag}">Product Tag</th>
					<th th:text="#{a.product_images}">Product Images</th>
					<th th:text="#{a.prod_Type}">Product Type</th>
					<th th:text="#{a.prod_Line}">Product Line</th>
					<th th:text="#{a.description}">Product Type Info</th>
					<th th:text="#{a.product_name}">Product Name</th>
					<th th:text="#{a.product_info}">Product Info</th>
					<th th:text="#{a.create_time}">Created Time</th>
					<th th:text="#{a.price}">Price</th>
					<th th:text="#{a.product_keywords}">Product Keywords</th>
					<th th:text="#{a.inventory_quantity}">Inventory Quantity</th>
					<th th:text="#{a.product_barcode}">Product Barcode</th>
					<th th:text="#{a.operate}">Operate</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="product : ${products}">
					<td th:text="${product.prodNum}"></td>
					<td th:text="${product.prodTags}"></td>
					<td>
						<!-- ⭐ 修正：使用 @{} 語法確保正確的 URL -->
						<img th:if="${product.prodImages != null and !product.prodImages.isEmpty()}"
						     class="product-image"
						     th:src="@{${product.prodImages}}"
						     th:alt="${product.prodName}"
						     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
						<div class="no-image" style="display: none;">無圖片</div>
						
						<div th:if="${product.prodImages == null or product.prodImages.isEmpty()}"
						     class="no-image">
							無圖片
						</div>
					</td>
					<td th:text="${product.category.prodType}"></td>
					<td th:text="${product.category.prodLine}"></td>
					<td th:text="${product.category.description}"></td>
					<td th:text="${product.prodName}"></td>
					<td th:text="${product.prodInfo}"></td>
					<td th:text="${product.createdTime}"></td>
					<td>
						<span th:text="${#numbers.formatDecimal(product.prodPrice, 0, 'COMMA', 2, 'POINT')} + ' ' + #{a.dollar}">0.00 dollar</span>
					</td>
					<td th:text="${product.prodKeywords}"></td>
					<td th:text="${product.prodStockQty}"></td>
					<td th:text="${product.prodBarcode}"></td>
					<td>
						<a th:href="@{/products/edit/{prodNum}(prodNum=${product.prodNum})}"
						   class="btn btn-warning btn-sm" th:text="#{a.edit}">edit</a>
						<a th:href="@{/products/delete/{prodNum}(prodNum=${product.prodNum})}"
						   class="btn btn-danger btn-sm"
						   th:onclick="|return confirm('#{a.delete_this_product}')|"
						   th:text="#{a.delete}">delete</a>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</body>
</html>